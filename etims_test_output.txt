Starting eTIMS API Tests for User: 254745050238

--- Running Step: 1. Lookup Customer (Buyer) ---
Endpoint: POST https://kratest.pesaflow.com/api/ussd/buyer-initiated/lookup
Payload: {
  "pin_or_id": "A016678608H"
}
Response Status: 200
Response Data: {
  "code": 3,
  "message": "Valid ID Number",
  "name": "MOSES MAINA SARUNI",
  "obligations": [],
  "pin": "A016678608H"
}

--- Running Step: 2. Submit Sales Invoice ---
Endpoint: POST https://kratest.pesaflow.com/api/ussd/post-sale
Payload: {
  "msisdn": "254745050238",
  "total_amount": 100,
  "items": [
    {
      "item_name": "Test Item",
      "taxable_amount": 100,
      "quantity": 1
    }
  ]
}

--- Running Step: 3. Submit Buyer Initiated Invoice ---
Endpoint: POST https://kratest.pesaflow.com/api/ussd/buyer-initiated/submit/invoice
Payload: {
  "msisdn": "254745050238",
  "buyer_pin": "A016678608H",
  "total_amount": 150,
  "items": [
    {
      "item_name": "Consultation",
      "taxable_amount": 150,
      "quantity": 1
    }
  ]
}

--- Running Step: 4. Fetch Invoices (Buyer View) ---
Endpoint: GET https://kratest.pesaflow.com/api/ussd/buyer-initiated/fetch/254745050238

--- Running Step: 5. Process Invoice (Action: Accept) ---
Endpoint: POST https://kratest.pesaflow.com/api/ussd/buyer-initiated/action/submit
Payload: {
  "action": "accept",
  "msisdn": "254745050238",
  "invoice": "BI-DUMMY-123"
}

--- Running Step: 6. Search Credit Note Invoice ---
Endpoint: POST https://kratest.pesaflow.com/api/ussd/search/credit-note
Payload: {
  "msisdn": "254745050238",
  "invoice_no": "INV-TEST-001"
}

--- Running Step: 7. Submit Credit Note (Partial) ---
Endpoint: POST https://kratest.pesaflow.com/api/ussd/submit/credit-note
Payload: {
  "msisdn": "254745050238",
  "invoice_no": "INV-TEST-001",
  "credit_note_type": "partial",
  "reason": "other",
  "items": [
    {
      "item_id": "ITEM-001",
      "return_quantity": 1
    }
  ]
}


=== TEST SUMMARY ===
┌─────────┬───────────────────────────────────────┬──────────┬───────────────────────────────────────┬─────────────────────────────────────────────────┐
│ (index) │ Step                                  │ Status   │ Endpoint                              │ Note                                            │
├─────────┼───────────────────────────────────────┼──────────┼───────────────────────────────────────┼─────────────────────────────────────────────────┤
│ 0       │ '1. Lookup Customer (Buyer)'          │ 'PASSED' │ '/buyer-initiated/lookup'             │ 'OK'                                            │
│ 1       │ '2. Submit Sales Invoice'             │ 'FAILED' │ '/post-sale'                          │ 'Unable to Create Etims Invoice'                │
│ 2       │ '3. Submit Buyer Initiated Invoice'   │ 'FAILED' │ '/buyer-initiated/submit/invoice'     │ '{"errors":{"detail":"Internal Server Error"}}' │
│ 3       │ '4. Fetch Invoices (Buyer View)'      │ 'FAILED' │ '/buyer-initiated/fetch/254745050238' │ 'No Invoices Found'                             │
│ 4       │ '5. Process Invoice (Action: Accept)' │ 'FAILED' │ '/buyer-initiated/action/submit'      │ '{"errors":{"detail":"Internal Server Error"}}' │
│ 5       │ '6. Search Credit Note Invoice'       │ 'FAILED' │ '/search/credit-note'                 │ 'Invalid Invoice Number'                        │
│ 6       │ '7. Submit Credit Note (Partial)'     │ 'FAILED' │ '/submit/credit-note'                 │ 'Unable to Create Etims Credit Note'            │
└─────────┴───────────────────────────────────────┴──────────┴───────────────────────────────────────┴─────────────────────────────────────────────────┘
